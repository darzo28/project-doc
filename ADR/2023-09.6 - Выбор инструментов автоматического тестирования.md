**Дата:** 7 ноября 2025 г.

**Статус:** Принято

### **Контекст**

Для обеспечения стабильности и качества системы  необходимо внедрить автоматическое тестирование.
Система должна поддерживать модульные, интеграционные, e2e (end-to-end) и нагрузочные тесты.
Инструменты тестирования должны быть совместимы с технологическим стеком проекта (NestJS, Next.js, PostgreSQL) и легко интегрироваться в CI/CD конвейер.

---

### **Рассмотренные варианты**

1. **Jest + Testing Library + Supertest (для backend и unit-тестов)**
   **Плюсы:**

   - Поддержка TypeScript «из коробки».
   - Простая интеграция с NestJS и React.
   - Отличная поддержка моков, шпионов и снапшотов.
   - Возможность тестирования REST и GraphQL API через Supertest.
   - Быстрая настройка и высокая производительность.

   **Минусы:**

   - Не предназначен для e2e тестирования пользовательских интерфейсов.

2. **Playwright (для e2e тестирования)**
   **Плюсы:**

   - Кроссбраузерное тестирование (Chromium, Firefox, WebKit).
   - Поддержка параллельного выполнения тестов.
   - Интеграция с CI/CD и генерация видео/скриншотов сессий.
   - Простая работа с авторизацией, cookie и сессиями.

   **Минусы:**

   - Требует дополнительного времени на настройку инфраструктуры.

3. **Cypress (альтернатива Playwright)**
   **Плюсы:**

   - Удобная панель разработчика и визуальное выполнение тестов.
   - Простая настройка для UI-тестов.

   **Минусы:**

   - Ограниченная поддержка мульти-вкладочных сценариев и нескольких доменов.
   - Менее гибкий API для сложных e2e сценариев.

4. **k6 (для нагрузочного тестирования)**
   **Плюсы:**

   - Простота написания сценариев на JavaScript.
   - Поддержка API, WebSocket и сценариев авторизации.
   - Интеграция с Grafana и Prometheus для визуализации метрик.

   **Минусы:**

   - Не предназначен для UI-тестирования.

### **Решение**

Выбраны следующие инструменты автоматического тестирования:

- **Jest + Testing Library + Supertest** — для модульных и интеграционных тестов.
- **Playwright** — для end-to-end тестирования клиентского интерфейса.
- **k6** — для нагрузочного тестирования.

### **Обоснование**

- **Полное покрытие:** Выбранный набор инструментов охватывает все уровни тестирования — от модульного до нагрузочного.
- **Совместимость:** Все решения нативно поддерживают TypeScript и хорошо интегрируются в стек NestJS/Next.js.
- **Автоматизация CI/CD:** Простая интеграция с GitHub Actions, GitLab CI и Jenkins для автоматического запуска тестов.
- **Отчётность:** Возможность генерации HTML и Allure-отчетов.
- **Масштабируемость:** Playwright и k6 позволяют выполнять тесты параллельно и в контейнерах.

### **Последствия**

- В проекте будут использоваться три типа тестирования:

  - **Unit и интеграционные тесты** — Jest, Supertest.
  - **E2E тесты** — Playwright.
  - **Нагрузочные тесты** — k6.
- Все тесты будут автоматически запускаться при push в основные ветки репозитория.
- Будет настроена система отчетности и уведомлений о неудачных тестах.
- QA-команда и разработчики получат единый подход к написанию и поддержке тестов.
- Требуется обучение команды использованию Playwright и k6 для сложных сценариев тестирования.
