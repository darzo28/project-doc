
**Дата:** 20 сентября 2023 г.

**Статус:** Принято

**Контекст:**

Требуется надежная, масштабируемая и производительная система хранения данных.База данных должна обеспечивать быстрое выполнение транзакций, поддержку сложных запросов, а также гарантировать согласованность и целостность данных.

**Рассмотренные варианты:**

1. **PostgreSQL:** 
Плюсы:
- Расширяемость и поддержка пользовательских функций, индексов и типов данных.
- Отличная производительность при сложных SQL-запросах.
- Встроенная поддержка JSON/JSONB для хранения неструктурированных данных.
- Репликация и кластеризация (Patroni, TimescaleDB, Citus).
- Поддержка транзакций, триггеров и строгих ограничений целостности.

Минусы:
- Требует оптимизации при высокой нагрузке на запись.
- Настройка кластеризации и репликации сложнее, чем у некоторых NoSQL решений.

2. **MySQL:** 
Плюсы:
- Простота настройки и высокая скорость чтения.
- Большое количество инструментов для администрирования.
- Поддержка репликации и шардирования.

Минусы:
- Менее гибкая система индексов и ограничений по сравнению с PostgreSQL.
- Ограниченные возможности для сложных аналитических запросов.

3. **MongoDB:** 
Плюсы:
- Гибкость структуры данных, документная модель JSON.
- Легкое масштабирование по горизонтали.
- Высокая скорость при операциях вставки и чтения.

Минусы:
- Отсутствие строгой транзакционности (в сравнении с реляционными СУБД).
- Сложнее поддерживать целостность данных.
- Не оптимальна для сложных связей и аналитики.

4. **Cassandra:** 
Плюсы:
- Отличная масштабируемость и отказоустойчивость.
- Подходит для распределенных систем с высокой нагрузкой.

Минусы:
- Сложность в настройке и эксплуатации.
- Не подходит для транзакционных систем с жесткими требованиями к согласованности данных.

**Решение:**

Выбран PostgreSQL.

**Обоснование:**

- **Надежность и транзакционность:** PostgreSQL полностью соответствует ACID-принципам, что критично для операций покупки и бронирования билетов.
- **Гибкость:** Возможность работать как с реляционными, так и с полуструктурированными данными (JSONB).
- **Масштабируемость:** Поддержка кластеризации и горизонтального масштабирования (Citus, Patroni).
- **Интеграция:** Простая интеграция с NestJS и другими backend-сервисами через ORM.
- **Соответствие требованиям безопасности:** Поддержка шифрования, ролевой модели доступа и журналирования.
- **Поддержка аналитики:** Возможность построения отчетов и запросов для организаторов и администраторов.
  
**Последствия:**

- Все основные данные (пользователи, заказы, концерты, платежи, отзывы) будут храниться в PostgreSQL.
- Для кэширования часто запрашиваемых данных (например, списка концертов) будет использоваться Redis.
- Необходимо обеспечить резервное копирование и репликацию для отказоустойчивости.
- Потребуется настроить мониторинг (PgBouncer, Prometheus, Grafana) и систему бэкапов.
- Возможное использование дополнительных расширений (например, PostGIS для работы с геоданными или TimescaleDB для аналитики посещаемости).

